package core

// grids.go contains predefined arena grids and functions to access them.

const (
	ArenaWidth  = 50
	ArenaHeight = 50

	PlayerStartLow = 12
	// TODO: this should be 37, but there's a bug when players don't all
	// start with even coordinates.
	PlayerStartHigh = 38
)

var grids = loadGridsFromStrings(gridData)

func GetGrid(level int) [][]Square {
	if level < 0 || level >= len(grids) {
		level = 0
	}
	return grids[level]
}

// GetStartVectors returns a slice of core.Vector representing the starting
// grid coordinates for the given number of players (up to 4).
// These positions are designed for the default 50x50 arena size grids in this file.
func GetStartVectors(numPlayers int) []Vector {
	// The positions are returned in a fixed order.
	allPositions := []Vector{
		{X: PlayerStartLow, Y: PlayerStartLow},   // Top-Left
		{X: PlayerStartHigh, Y: PlayerStartHigh}, // Bottom-Right
		{X: PlayerStartLow, Y: PlayerStartHigh},  // Bottom-Left
		{X: PlayerStartHigh, Y: PlayerStartLow},  // Top-Right
	}

	if numPlayers <= 0 || numPlayers > len(allPositions) {
		return nil
	}

	return allPositions[:numPlayers]
}

func loadGridsFromStrings(gridData [][]string) [][][]Square {
	var grids [][][]Square

	for _, level := range gridData {
		height := len(level)
		if height == 0 {
			return nil
		}
		width := len(level[0])
		grid := make([][]Square, height)
		for y := range height {
			grid[y] = make([]Square, width)
			for x := range width {
				if level[y][x] == '#' {
					grid[y][x] = Wall
				} else {
					grid[y][x] = Open
				}
			}
		}
		grids = append(grids, grid)
	}
	return grids
}

var gridData = [][]string{
	{
		"##################################################",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"##################################################",
	},
	{
		"##################################################",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................################................#",
		"#................#..............#................#",
		"#................#..............#................#",
		"#................#..............#................#",
		"#................#..............#................#",
		"#................#..............#................#",
		"#................#..............#................#",
		"#................#..............#................#",
		"#................#..............#................#",
		"#................#..............#................#",
		"#................#..............#................#",
		"#................#..............#................#",
		"#................#..............#................#",
		"#................#..............#................#",
		"#................#..............#................#",
		"#................################................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"##################################################",
	}, {
		"##################################################",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#....................########....................#",
		"#....................#......#....................#",
		"#....................#......#....................#",
		"#....................#......#....................#",
		"#....................#......#....................#",
		"#....................#......#....................#",
		"#....................#......#....................#",
		"#....................########....................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#....########....................................#",
		"#....#......#........................########....#",
		"#....#......#........................#......#....#",
		"#....#......#........................#......#....#",
		"#....#......#........................#......#....#",
		"#....#......#........................#......#....#",
		"#....#......#........................#......#....#",
		"#....########........................#......#....#",
		"#....................................########....#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#....................########....................#",
		"#....................#......#....................#",
		"#....................#......#....................#",
		"#....................#......#....................#",
		"#....................#......#....................#",
		"#....................#......#....................#",
		"#....................#......#....................#",
		"#....................########....................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"##################################################",
	}, {
		"##################################################",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#...................##########...................#",
		"#...................#........#...................#",
		"#...................#........#...................#",
		"#...................#........#...................#",
		"#...................#........#...................#",
		"#...................#........#...................#",
		"#...................#........#...................#",
		"#...................#........#...................#",
		"#...................#........#...................#",
		"#..........##########........##########..........#",
		"#..........#..........................#..........#",
		"#..........#..........................#..........#",
		"#..........#..........................#..........#",
		"#..........#..........................#..........#",
		"#..........#..........................#..........#",
		"#..........#..........................#..........#",
		"#..........#..........................#..........#",
		"#..........#..........................#..........#",
		"#..........##########........##########..........#",
		"#...................#........#...................#",
		"#...................#........#...................#",
		"#...................#........#...................#",
		"#...................#........#...................#",
		"#...................#........#...................#",
		"#...................#........#...................#",
		"#...................#........#...................#",
		"#...................#........#...................#",
		"#...................##########...................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"##################################################",
	}, {
		"##################################################",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#.....##########..................##########.....#",
		"#.....#........#..................#........#.....#",
		"#.....#.########..................########.#.....#",
		"#.....#.#................................#.#.....#",
		"#.....#.#................................#.#.....#",
		"#.....#.#................................#.#.....#",
		"#.....#.#................................#.#.....#",
		"#.....#.#................................#.#.....#",
		"#.....#.#................................#.#.....#",
		"#.....###................................###.....#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#.....###................................###.....#",
		"#.....#.#................................#.#.....#",
		"#.....#.#................................#.#.....#",
		"#.....#.#................................#.#.....#",
		"#.....#.#................................#.#.....#",
		"#.....#.#................................#.#.....#",
		"#.....#.#................................#.#.....#",
		"#.....#.########..................########.#.....#",
		"#.....#........#..................#........#.....#",
		"#.....##########..................##########.....#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"#................................................#",
		"##################################################",
	},
}
